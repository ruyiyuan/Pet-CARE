<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PetCare — Owner Portal (Demo)</title>
<style>
:root{--bg:#f6fbfc;--card:#fff;--muted:#6b7280;--accent:#06b6d4;--radius:12px}
*{box-sizing:border-box}
body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:0;background:linear-gradient(180deg,#f8fcfd,#eef8fa);color:#072127;padding:28px}
.wrap{max-width:1000px;margin:0 auto}
.header{display:flex;align-items:center;gap:12px;margin-bottom:18px}
.logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#0aa) ;display:flex;align-items:center;justify-content:center;color:#022;font-weight:700}
h1{margin:0;font-size:20px}
.sub{color:var(--muted);font-size:13px;margin-top:4px}

.grid{display:grid;grid-template-columns:1fr 340px;gap:18px}
@media (max-width:920px){.grid{grid-template-columns:1fr}}

.card{background:var(--card);padding:16px;border-radius:var(--radius);box-shadow:0 8px 26px rgba(6,22,27,0.06)}
label{display:block;color:var(--muted);font-size:13px;margin-top:10px}
input[type=text],input[type=date],select,textarea{width:100%;padding:10px;border-radius:10px;border:1px solid #e7f0f2;margin-top:6px;background:transparent}
textarea{min-height:80px;resize:vertical}
.btn{background:var(--accent);border:0;padding:10px 12px;border-radius:10px;color:#022;cursor:pointer;font-weight:600}
.btn.alt{background:#eef9fa}
.small{font-size:13px;color:var(--muted)}
.list{margin-top:12px;max-height:520px;overflow:auto;padding-right:6px}
.item{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:10px;border:1px solid #eef6f8;margin-bottom:10px;background:#fff}
.p-thumb{height:58px;width:58px;border-radius:8px;object-fit:cover;border:1px solid #eef6f8}
.linkbox{width:100%;padding:8px;border-radius:8px;border:1px solid #e6eef6;background:#fafcff;margin-top:8px}
.gallery img{height:90px;border-radius:8px;object-fit:cover;border:1px solid #eef6f8;margin-right:8px;margin-bottom:8px}
.footer{margin-top:12px;color:var(--muted);font-size:13px}
.kv{font-size:13px;color:var(--muted);margin-top:6px}
.badge{display:inline-block;padding:6px 10px;border-radius:999px;background:#f0feff;color:#024;margin-top:8px}
</style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="logo">PC</div>
      <div>
        <h1>PetCare — Owner Portal (Demo)</h1>
        <div class="sub">Owner-facing portal: create bookings and receive media links from hosts. Demo stores data locally.</div>
      </div>
    </div>

    <div class="grid">
      <!-- Left: form & list -->
      <div>
        <div class="card">
          <strong>Create Booking (Owner)</strong>
          <div class="small" style="margin-top:6px">Fill owner & pet info and choose a service type.</div>

          <label>Owner name</label>
          <input id="ownerName" type="text" placeholder="e.g. Li Hua">

          <label>Contact (phone or email)</label>
          <input id="contact" type="text" placeholder="e.g. +86 13xxxx or li@example.com">

          <label>Pet name</label>
          <input id="petName" type="text" placeholder="e.g. Bean">

          <label>Service type</label>
          <select id="serviceType">
            <option>Day Care</option>
            <option>Dog Walking</option>
            <option>Boarding</option>
            <option>In-Home Vet</option>
          </select>

          <div style="display:flex;gap:8px">
            <div style="flex:1">
              <label>Start date</label>
              <input id="fromDate" type="date">
            </div>
            <div style="flex:1">
              <label>End date</label>
              <input id="toDate" type="date">
            </div>
          </div>

          <label style="margin-top:8px">Notes (medical, meds, behavior)</label>
          <textarea id="notes" placeholder="Allergies, medication, special care"></textarea>

          <div style="display:flex;gap:8px;margin-top:8px;align-items:center">
            <button class="btn" id="saveBtn">Submit Booking</button>
            <button class="btn alt" id="clearForm">Clear</button>
            <div style="margin-left:auto" class="small">Demo uses localStorage</div>
          </div>
        </div>

        <div class="card" style="margin-top:14px">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <strong>My Bookings</strong>
            <div>
              <input id="filterDate" type="date" style="padding:8px;border-radius:8px;border:1px solid #eef6f8"/>
            </div>
          </div>

          <div class="list" id="bookingList" aria-live="polite"></div>

          <div style="display:flex;gap:8px;margin-top:10px">
            <button class="btn" id="exportCsv">Export CSV</button>
            <button class="btn alt" id="clearAll">Clear All</button>
          </div>
        </div>
      </div>

      <!-- Right: details & media (owner pastes host-provided media URLs) -->
      <div class="card">
        <strong>Booking Details & Media</strong>
        <div id="detailArea" class="small" style="margin-top:8px">Select a booking from the left to view details and add media links provided by the host.</div>

        <div id="detailBox" style="margin-top:12px;display:none">
          <div id="detailContent"></div>

          <div style="margin-top:10px">
            <label>Paste media URL(s) from host (one per line)</label>
            <textarea id="mediaUrls" placeholder="https://.../photo1.jpg&#10;https://.../video1.mp4"></textarea>
            <div style="display:flex;gap:8px;margin-top:8px">
              <button class="btn" id="attachMedia">Attach URLs</button>
              <button class="btn alt" id="clearMedia">Clear media</button>
            </div>
            <div class="gallery" id="mediaGallery"></div>
          </div>

          <div style="margin-top:12px">
            <button class="btn" id="copyLink">Generate & Copy Share Link</button>
            <input id="shareLink" readonly class="linkbox" />
          </div>
        </div>

        <div class="footer small" style="margin-top:14px">
          Note: This demo stores data locally (localStorage). In production, hosts would upload media to cloud storage and the platform would centralize media URLs in a backend.
        </div>
      </div>
    </div>
  </div>

<script>
/* storage */
const KEY = "petcare_owner_portal_v1";
function loadAll(){ try { return JSON.parse(localStorage.getItem(KEY)||"[]") } catch(e){ return [] } }
function saveAll(a){ localStorage.setItem(KEY, JSON.stringify(a)) }

/* utils */
function id(){ return 'b-'+Date.now().toString(36)+'-'+Math.floor(Math.random()*9000+1000) }
function esc(s){ return (s||'').toString().replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])) }

/* elements */
const bookingList = document.getElementById('bookingList');
const detailBox = document.getElementById('detailBox');
const detailContent = document.getElementById('detailContent');
const mediaGallery = document.getElementById('mediaGallery');
const shareLink = document.getElementById('shareLink');
const mediaUrls = document.getElementById('mediaUrls');

let bookings = loadAll();

/* render list */
function renderList(){
  bookingList.innerHTML = '';
  const f = document.getElementById('filterDate').value;
  const shown = bookings.filter(it=>{
    if(!f) return true;
    return (it.fromDate<=f && f<=it.toDate) || it.fromDate===f || it.toDate===f;
  }).sort((a,b)=> new Date(b.createdAt)-new Date(a.createdAt));

  if(shown.length===0){ bookingList.innerHTML = '<div class="small" style="padding:8px;color:var(--muted)">No bookings yet</div>'; return }

  shown.forEach(it=>{
    const el = document.createElement('div'); el.className='item';
    el.innerHTML = `
      <div>
        <div style="font-weight:700">${esc(it.petName)} <span class="small" style="color:var(--muted)">— ${esc(it.serviceType)}</span></div>
        <div class="kv">${it.fromDate} → ${it.toDate} • ${esc(it.extras||'')}</div>
        <div class="kv">Owner: ${esc(it.ownerName)} • ${esc(it.contact)}</div>
      </div>
      <div style="display:flex;flex-direction:column;gap:8px;align-items:flex-end">
        <div class="small" style="color:var(--muted)">${new Date(it.createdAt).toLocaleString()}</div>
        <div style="display:flex;gap:8px">
          <button class="btn" onclick="viewBooking('${it.id}')">View</button>
          <button class="btn alt" style="background:#fee2e2;color:#b91c1c" onclick="deleteBooking('${it.id}')">Delete</button>
        </div>
      </div>
    `;
    bookingList.appendChild(el);
  });
}

/* add booking */
document.getElementById('saveBtn').onclick = ()=>{
  const ownerName = document.getElementById('ownerName').value.trim();
  const contact = document.getElementById('contact').value.trim();
  const petName = document.getElementById('petName').value.trim();
  const serviceType = document.getElementById('serviceType').value;
  const fromDate = document.getElementById('fromDate').value;
  const toDate = document.getElementById('toDate').value;
  const extras = document.getElementById('extras').value;
  const notes = document.getElementById('notes').value.trim();

  if(!ownerName || !contact || !petName || !fromDate){ alert('Please fill required fields: owner, contact, pet, start date'); return }

  const booking = {
    id: id(),
    ownerName, contact, petName, serviceType,
    fromDate, toDate: toDate||fromDate, extras, notes,
    media: [], createdAt: new Date().toISOString()
  };
  bookings.push(booking);
  saveAll(bookings);
  renderList();
  clearForm();
  alert('Booking created. Share the generated link with your chosen host to receive media.');
}

/* clear form */
document.getElementById('clearForm').onclick = ()=> {
  clearForm();
}
function clearForm(){
  ['ownerName','contact','petName','fromDate','toDate','extras','notes'].forEach(id=>document.getElementById(id).value='');
}

/* view booking */
window.viewBooking = function(id){
  const b = bookings.find(x=>x.id===id);
  if(!b) return;
  detailBox.style.display='block';
  detailContent.innerHTML = `
    <div style="font-weight:700">${esc(b.petName)} <span class="small" style="color:var(--muted)">— ${esc(b.serviceType)}</span></div>
    <div class="kv">Owner: ${esc(b.ownerName)} • ${esc(b.contact)}</div>
    <div class="kv">${esc(b.fromDate)} → ${esc(b.toDate)}</div>
    <div class="kv" style="margin-top:6px;color:var(--muted)">Notes: ${esc(b.notes||'—')}</div>
  `;
  // render gallery
  renderGallery(b);
  // prepare share link (owner can send to host so host can upload media in their system)
  const url = new URL(location.href);
  url.searchParams.set('viewBooking', b.id);
  shareLink.value = url.toString();
  mediaUrls.value = (b.media||[]).map(m=>m.url).join('\n');
}

/* attach media URLs (owner pastes URLs that host provided) */
document.getElementById('attachMedia').onclick = ()=>{
  const text = mediaUrls.value.trim();
  const viewId = new URLSearchParams(location.search).get('viewBooking') || shareLink.value && (()=>{ try{ return new URL(shareLink.value).searchParams.get('viewBooking') }catch(e){return null} })();
  if(!viewId){ alert('Select a booking first (click View).'); return }
  const b = bookings.find(x=>x.id===viewId);
  if(!b){ alert('Booking not found.'); return }
  if(!text){ alert('Paste at least one media URL.'); return }
  const urls = text.split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
  // add as media objects (url + timestamp)
  for(const u of urls){
    b.media.push({id:id(), url:u, ts:new Date().toISOString()});
  }
  saveAll(bookings);
  renderGallery(b);
  renderList();
  alert('Media URLs attached.');
}

/* clear media for selected booking */
document.getElementById('clearMedia').onclick = ()=>{
  const viewId = new URLSearchParams(location.search).get('viewBooking') || shareLink.value && (()=>{ try{ return new URL(shareLink.value).searchParams.get('viewBooking') }catch(e){return null} })();
  if(!viewId){ alert('Select a booking first (click View).'); return }
  const b = bookings.find(x=>x.id===viewId);
  if(!b){ alert('Booking not found'); return }
  if(!confirm('Clear all media for this booking?')) return;
  b.media = [];
  saveAll(bookings);
  renderGallery(b);
  renderList();
}

/* render gallery */
function renderGallery(b){
  mediaGallery.innerHTML = '';
  if(!b.media || b.media.length===0){ mediaGallery.innerHTML = '<div class="small" style="color:var(--muted)">No media yet</div>'; return }
  b.media.slice().reverse().forEach(m=>{
    // if it's an image show img, else show link
    const lower = m.url.toLowerCase();
    if(lower.match(/\.(jpg|jpeg|png|gif|webp)$/)){
      const img = document.createElement('img'); img.src = m.url; img.alt='media'; img.onclick = ()=> window.open(m.url,'_blank'); mediaGallery.appendChild(img);
    } else {
      const a = document.createElement('a'); a.href = m.url; a.target='_blank'; a.textContent = m.url; a.className='small'; mediaGallery.appendChild(a);
    }
  });
}

/* delete booking */
window.deleteBooking = function(id){
  if(!confirm('Delete booking?')) return;
  bookings = bookings.filter(x=>x.id!==id);
  saveAll(bookings);
  renderList();
  detailBox.style.display='none';
}

/* export CSV */
document.getElementById('exportCsv').onclick = ()=>{
  if(bookings.length===0){ alert('No bookings'); return }
  const header = ['id','ownerName','contact','petName','serviceType','fromDate','toDate','extras','notes','createdAt'];
  const rows = bookings.map(b=> header.map(h=> `"${(b[h]||'').toString().replace(/"/g,'""')}"`).join(','));
  const csv = [header.join(',')].concat(rows).join('\n');
  const blob = new Blob([csv],{type:'text/csv'});
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'petcare_bookings_owner.csv'; a.click();
  URL.revokeObjectURL(a.href);
}

/* copy link */
document.getElementById('copyLink').onclick = ()=>{
  const v = shareLink.value;
  if(!v){ alert('No booking selected'); return }
  navigator.clipboard?.writeText(v).then(()=>alert('Share link copied')).catch(()=>prompt('Copy manually:',v));
}

/* filter */
document.getElementById('filterDate').addEventListener('change', ()=> renderList());

/* handle query param */
function handleQueryParam(){
  const params = new URLSearchParams(location.search);
  const viewId = params.get('viewBooking');
  if(viewId){
    const one = bookings.find(x=>x.id===viewId);
    if(one){ viewBooking(viewId); document.querySelector('#detailBox')?.scrollIntoView({behavior:'smooth'}); }
    else {
      detailBox.style.display='block';
      detailContent.innerHTML = '<div class="small" style="color:var(--muted)">Booking ID not found locally on this device.</div>';
      shareLink.value = location.href;
    }
  }
}

/* init */
renderList();
handleQueryParam();
window._petcare_owner = {bookings, saveAll, loadAll};
</script>
</body>
</html>

window._petcare_owner = {bookings, saveAll, loadAll};
</script>
</body>
</html>
